/**
 * @module       jQuery RD Instafeed
 * @author       Rafael Shayvolodyan(raffa)
 * @version      1.2.2
 */

(function(){(function(h,t,r){var q=function(){function d(a,b){this.options=h.extend(!0,{},this.Defaults,b);this.$element=h(a);this.element=a;this.$items=this.$element.find("[data-instafeed-item]");this.unique=this.genKey();this.nextUrl="";this.initialize()}d.prototype.Defaults={accessToken:"5526956400.ba4c844.c832b2a554764bc8a1c66c39e99687d7",clientId:" c832b2a554764bc8a1c66c39e99687d7",userId:"5526956400",get:"user",tagName:"awesome",locationId:"",sortBy:"most-recent",useHttp:!1,showLog:!1,dateFormat:{seconds:"less than a minute ago",
minute:"about a minute ago",minutes:" minutes ago",hour:"about an hour ago",hours:" hours ago",day:"1 day ago",days:"%b/%d/%Y"}};d.prototype.initialize=function(){if("string"!==typeof this.options.clientId&&"string"!==typeof this.options.accessToken)throw Error("Missing clientId or accessToken.");null!=this.options.before&&"function"===typeof this.options.before&&this.options.before.call(this);this.fetchData(this,this.buildUrl(),null)};d.prototype.fetchData=function(a,b,f){var e=a.element.getAttribute("data-instafeed-get")?
a.element.getAttribute("data-instafeed-get"):a.options.get;h.ajax({type:"GET",dataType:"jsonp",cache:!1,url:b,success:function(c){if(null!=f){var b=f;b.push.apply(b,c.data)}else b=c.data;null!=c.pagination&&(a.nextUrl=c.pagination.next_url);if("profile"!==e){var g=parseInt(a.$items.length,10);if(b.length>=g)return b=a.sorting(a,b),b=b.slice(0,g),a.validate(a,c),a.options.showLog&&console.log(b),a.loopData(b);if(null!=a.nextUrl)return a.fetchData(a,c.pagination.next_url,b);if(b.length<g)for(;b.length!=
g;)for(var d in b)if(b.length<g)b.push(b[d]);else break;b=a.sorting(a,b);a.validate(a,c);return a.loopData(b)}a.validate(a,c);a.options.showLog&&console.log(b);return a.loopData(b)}})};d.prototype.validate=function(a,b){if("object"!==typeof b){if(null!=a.options.error&&"function"===typeof a.options.error)return a.options.error.call(this,"Invalid JSON data"),!1;throw Error("Invalid JSON response");}if(200!==b.meta.code){if(null!=a.options.error&&"function"===typeof a.options.error)return a.options.error.call(this,
b.meta.error_message),!1;throw Error("Error from Instagram: "+b.meta.error_message);}if(0===b.data.length){if(null!=a.options.error&&"function"===typeof a.options.error)return a.options.error.call(this,"No images were returned from Instagram"),!1;throw Error("No images were returned from Instagram");}};d.prototype.sorting=function(a,b){if("profile"!==(a.element.getAttribute("data-instafeed-get")?a.element.getAttribute("data-instafeed-get"):a.options.get)){var f=a.element.getAttribute("data-instafeed-sort")?
a.element.getAttribute("data-instafeed-sort"):a.options.sortBy;if("none"!==f){var e="random"===f?["","random"]:f.split("-");var c="least"===e[0]?!0:!1;switch(e[1]){case "random":b.sort(function(){return.5-Math.random()});break;case "recent":b=a.sortBy(b,"created_time",c);break;case "liked":b=a.sortBy(b,"likes.count",c);break;case "commented":b=a.sortBy(b,"comments.count",c);break;default:throw Error("Invalid option for sortBy: '"+f+"'.");}}}return b};d.prototype.loopData=function(a){var b,f,e;var c=
this;null!=c.options.filter&&"function"===typeof c.options.filter&&(a=ctxfilter(a,c.options.filter));if(Array.isArray(a))for(e=0;e<a.length;){a[e].tags_full=c.arrToString(a[e].tags);var m=f=b=-1;c.$items.eq(e).find("*").each(function(){c.checkAttribute(this,"data-instafeed-comment")?b++:c.checkAttribute(this,"data-instafeed-like")?f++:c.checkAttribute(this,"data-instafeed-location")?m++:c.checkAttribute(this,"data-comments-data")||(c.checkAttribute(this,"data-likes-data")?c.parseAttributes(this,a[e],
f):c.checkAttribute(this,"data-locations-data")?c.parseAttributes(this,a[e],m):c.parseAttributes(this,a[e],0))});e++}else a.link="https://www.instagram.com/"+a.username,c.$element.find("*").not("[data-instafeed-item], [data-instafeed-item] *, [data-instafeed-get]").each(function(){return c.parseAttributes(this,a,0)});null!=c.options.after&&"function"===typeof c.options.after&&c.options.after.call(this);return!0};d.prototype.checkAttribute=function(a,b){var f;var e=a.attributes;var c=0;for(f=e.length;c<
f;c++){var m=e[c];if(-1<m.name.indexOf(b))return!0}return!1};d.prototype.parseAttributes=function(a,b,f){var e,c,m,g;var d=a.attributes;for(c in d)if(null!=d[c]&&"object"===typeof d[c]&&-1!==d[c].name.indexOf("data-")&&-1===d[c].name.indexOf("data-instafeed-")){var n=d[c].name.substring(5);var k=null;if(-1!==n.indexOf("-")){var h=n.split("-");k=b;var p=0;for(e=h.length;p<e;p++){var l=h[p];"data"===l&&null!=k[l]&&null!=k[l][f]?k=k[l][f]:null!=k[l]&&(k=k[l])}}if("string"===typeof d[c].value&&(p=d[c].value.split(/\s?,\s?/i),
null!=k?g=k:null!=b[n]&&(g=b[n]),-1!==n.indexOf("created_time")&&(m=g),null!=g&&null!=p&&("string"===typeof g||"number"===typeof g)))for(l=0,h=p.length;l<h;l++)k=p[l],-1!==n.indexOf("created_time")&&(g="datetime"===k?this.dating(m,!0):this.dating(m,!1)),"text"===k.toLowerCase()?a.innerHTML=g:"type"===n&&"image"!==g?a.setAttribute(k,"iframe"):(e=k.charAt(0),"0"<=e&&"9">=e||a.setAttribute(k,g))}};d.prototype.arrToString=function(a){return a.join(" ")};d.prototype.dating=function(a,b){var f;var e=new Date(1E3*
a);var c=new Date;var d=parseInt((c.getTime()-e.getTime())/1E3);d+=60*c.getTimezoneOffset();c="January February March April May June July August September October November December".split(" ");e={"%d":e.getDate(),"%m":e.getMonth()+1,"%b":c[e.getMonth()].substring(0,3),"%B":c[e.getMonth()],"%y":String(e.getFullYear()).slice(-2),"%Y":e.getFullYear()};c=b?"%Y-%m-%d":this.element.getAttribute("data-instafeed-date-format")?this.element.getAttribute("data-instafeed-date-format"):this.options.dateFormat.days;
if(60>d)return this.options.dateFormat.seconds;if(120>d)return this.options.dateFormat.minute;if(3600>d)return parseInt(d/60).toString()+this.options.dateFormat.minutes;if(7200>d)return this.options.dateFormat.hour;if(86400>d)return"about "+parseInt(d/3600).toString()+this.options.dateFormat.hours;if(172800>d)return this.options.dateFormat.day;var g=c.match(/%[dmbByY]/g);var h=0;for(f=g.length;h<f;h++)d=g[h],c=c.replace(d,e[d]);return c};d.prototype.sortBy=function(a,b,d){a.sort(function(a,c){var e=
this.getObjectProperty(a,b);var f=this.getObjectProperty(c,b);return d?e>f?1:-1:e<f?1:-1}.bind(this));return a};d.prototype.getObjectProperty=function(a,b){var d;b=b.replace(/\[(\w+)\]/g,".$1");for(d=b.split(".");d.length;){var e=d.shift();if(null!=a&&e in a)a=a[e];else return null}return a};d.prototype.buildUrl=function(){var a=this.element.getAttribute("data-instafeed-get")?this.element.getAttribute("data-instafeed-get"):this.options.get;switch(a){case "tagged":var b=this.element.getAttribute("data-instafeed-tagname")?
this.element.getAttribute("data-instafeed-tagname"):this.options.tagName;if(!b)throw Error("No tag name specified. Use the 'tagName' option.");b="tags/"+b+"/media/recent";break;case "location":b=this.element.getAttribute("data-instafeed-location")?this.element.getAttribute("data-instafeed-location"):this.options.location;if(!b)throw Error("No location specified. Use the 'locationId' option.");b="locations/"+b+"/media/recent";break;case "user":b=this.element.getAttribute("data-instafeed-user")?this.element.getAttribute("data-instafeed-user"):
this.options.userId;if(!b)throw Error("No user specified. Use the 'userId' option.");b="users/"+b+"/media/recent";break;case "profile":b=this.element.getAttribute("data-instafeed-user")?this.element.getAttribute("data-instafeed-user"):this.options.userId;if(!b)throw Error("No user specified. Use the 'userId' option.");b="users/"+b;break;default:throw Error("Invalid option for get: '"+this.options.get+"'.");}var d="https://api.instagram.com/v1/"+b;b=this.element.getAttribute("data-instafeed-accesstoken")?
this.element.getAttribute("data-instafeed-accesstoken"):this.options.accessToken;var e=this.element.getAttribute("data-instafeed-clientid")?this.element.getAttribute("data-instafeed-clientid"):this.options.clientId;d=b?d+("?access_token="+b):d+("?client_id="+e);this.$items.length&&"profile"!==a&&(d+="&count="+this.$items.length);return d+="&callback=instafeedCache"+this.unique+".parse"};d.prototype.genKey=function(){var a=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return""+
a()+a()+a()+a()};d.prototype.filter=function(a,b){var d;var e=[];var c=function(a){if(b(a))return e.push(a)};var h=0;for(d=a.length;h<d;h++){var g=a[h];c(g)}return e};return d}();h.fn.extend({RDInstafeed:function(d){return this.each(function(){var a=h(this);if(!a.data("RDInstafeed"))return a.data("RDInstafeed",new q(this,d))})}});return r.RDInstafeed=q})(window.jQuery,document,window);"undefined"!==typeof module&&null!==module?module.exports=window.RDInstafeed:"function"===typeof define&&define.amd&&
define(["jquery"],function(){return window.RDInstafeed})}).call(this);